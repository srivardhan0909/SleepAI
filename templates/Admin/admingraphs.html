{% extends 'Admin/adminbase.html' %} {% block contents %}
<div class="container mt-4">
  <h2 class="mb-4 text-center" style="font-family: 'Poppins', sans-serif; font-weight: 600;">Sleep Disorder Analysis Graphs</h2>

  {% if error %}
  <div class="alert alert-danger">Error: {{ error }}</div>
  {% endif %}

  <!-- Debug Information -->
  {% if debug_info %}
  <div class="alert alert-info">
    <h4>Debug Information:</h4>
    <p>Total Predictions: {{ debug_info.total_predictions }}</p>
    <p>Gender Data: {{ debug_info.gender_data }}</p>
    <p>BMI Data: {{ debug_info.bmi_data }}</p>
    <p>Blood Pressure Data: {{ debug_info.bp_data }}</p>
    <p>Result Data: {{ debug_info.result_data }}</p>
  </div>
  {% endif %}

  <div class="row">
    <!-- Gender Distribution -->
    <div class="mb-4 col-md-6">
      <div class="card">
        <div class="card-body">
          <h5 class="card-title">Gender Distribution</h5>
          <div style="height: 300px">
            <canvas id="genderChart"></canvas>
          </div>
        </div>
      </div>
    </div>

    <!-- BMI Distribution -->
    <div class="mb-4 col-md-6">
      <div class="card">
        <div class="card-body">
          <h5 class="card-title">BMI Category Distribution</h5>
          <div style="height: 300px">
            <canvas id="bmiChart"></canvas>
          </div>
        </div>
      </div>
    </div>

    <!-- Blood Pressure Distribution -->
    <div class="mb-4 col-md-6">
      <div class="card">
        <div class="card-body">
          <h5 class="card-title">Blood Pressure Distribution</h5>
          <div style="height: 300px">
            <canvas id="bpChart"></canvas>
          </div>
        </div>
      </div>
    </div>

    <!-- Prediction Results -->
    <div class="mb-4 col-md-6">
      <div class="card">
        <div class="card-body">
          <h5 class="card-title">Prediction Results Distribution</h5>
          <div style="height: 300px">
            <canvas id="resultChart"></canvas>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Include Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.0/dist/chart.min.js"></script>

<script>
  window.onload = function() {
      try {
          // Gender Chart
          new Chart(document.getElementById('genderChart'), {
              type: 'pie',
              data: {
                  labels: {{ gender_labels|safe }},
                  datasets: [{
                      data: {{ gender_counts|safe }},
                      backgroundColor: ['#FF6384', '#36A2EB']
                  }]
              },
              options: {
                  responsive: true,
                  maintainAspectRatio: false
              }
          });

          // BMI Chart
          new Chart(document.getElementById('bmiChart'), {
              type: 'pie',
              data: {
                  labels: {{ bmi_labels|safe }},
                  datasets: [{
                      data: {{ bmi_counts|safe }},
                      backgroundColor: ['#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0']
                  }]
              },
              options: {
                  responsive: true,
                  maintainAspectRatio: false
              }
          });

          // Blood Pressure Chart
          new Chart(document.getElementById('bpChart'), {
              type: 'bar',
              data: {
                  labels: {{ bp_labels|safe }},
                  datasets: [{
                      label: 'Count',
                      data: {{ bp_counts|safe }},
                      backgroundColor: '#36A2EB'
                  }]
              },
              options: {
                  responsive: true,
                  maintainAspectRatio: false,
                  scales: {
                      y: {
                          beginAtZero: true
                      }
                  }
              }
          });

          // Prediction Results Chart
          new Chart(document.getElementById('resultChart'), {
              type: 'pie',
              data: {
                  labels: {{ result_labels|safe }},
                  datasets: [{
                      data: {{ result_counts|safe }},
                      backgroundColor: ['#FF6384', '#36A2EB', '#FFCE56']
                  }]
              },
              options: {
                  responsive: true,
                  maintainAspectRatio: false
              }
          });
      } catch (error) {
          console.error('Error creating charts:', error);
          document.querySelector('.container').innerHTML += `
              <div class="mt-3 alert alert-danger">
                  Error creating charts: ${error.message}
              </div>
          `;
      }
  };
</script>
{% endblock %}
